import "mocha"
import { expect } from "chai"
import JSONCrush from "jsoncrush"

const jestConsole = console

beforeEach(() => {
  global.console = require("console")
})

afterEach(() => {
  global.console = jestConsole
})

describe("jsonCrush", () => {
  const jsonstring = `{"init":[0.012036538172433933,0.33515935284544385,-0.8647,-0.2402,-0.8642,0.2399,-0.8644,0.0003,-0.0002,0,0.5091682967509515,0.002340117390845597,1.204217044875723,0.054814969344486715,0.7560122401274153,-0.07057980214846309,0.842956044128091,0.03368814504550459,0.8466587903395358,-0.03406437653267602,0.9019711833609422,0.001522602982229516,0.9079061608180677,-0.07458275710783385,0.5032380851806842,0.6500959509066422,-0.2519582779129382,-0.669219410172663,1.0726320062467571,0.6356832499974137,0.96088048371321,-0.03395033336547472,1.0661711927020487,-0.2769575084675987,-1.3249585021233543,-0.49128784704166323,1.3891415858689493,-0.1598179370999615,1.0250741417899258,0.12195201059909293,1.3878089165732264,0.2816216899451193,1.2225914314605695,0.47491405615226157],"shots":[{"type":"AIM","offset":{"x":0.0945945945945946,"y":-0.28378378378378377,"z":0},"angle":0.2861325326537706,"power":2.6527500000000006,"pos":{"x":0.012036538172433933,"y":0.33515935284544385,"z":0},"i":0},{"type":"AIM","offset":{"x":-0.19416924658078394,"y":0.22868822375070108,"z":0},"angle":-0.5479710322722136,"power":2.6527500000000006,"pos":{"x":0.6489260353080882,"y":0.4459939877797891,"z":0},"i":0},{"type":"RERACK","ballinfo":{"balls":[{"pos":{"x":1.179,"y":0,"z":0},"id":6}]}},{"type":"AIM","offset":{"x":0.1671966562550577,"y":0.24908889605345333,"z":0},"angle":0.09942916699690399,"power":1.4737500000000001,"pos":{"x":0.5517325040886984,"y":-0.2756910138188343,"z":0},"i":0},{"type":"AIM","offset":{"x":-0.06756756756756757,"y":-0.08558558558558559,"z":0},"angle":0.9313012732593017,"power":2.4562500000000003,"pos":{"x":-0.9957897817629141,"y":-0.4078939441177586,"z":0},"i":0},{"type":"RERACK","ballinfo":{"balls":[{"pos":{"x":-0.8646,"y":-0.24016666666666672,"z":0},"id":1}]}},{"type":"AIM","offset":{"x":0.26105161291056883,"y":0.14782440731080404,"z":0},"angle":-2.4304044227833406,"power":2.4562500000000003,"pos":{"x":-1.084788701166196,"y":-0.2521772252352722,"z":0},"i":0},{"type":"AIM","offset":{"x":0.17040114235151227,"y":-0.24690777769300754,"z":0},"angle":2.8503146757042273,"power":3.43875,"pos":{"x":0.26257470993918025,"y":-0.09226044657977024,"z":0},"i":0},{"type":"RERACK","ballinfo":{"balls":[{"pos":{"x":0,"y":0,"z":0},"id":4}]}},{"type":"AIM","offset":{"x":0.17040114235151227,"y":-0.046907777693007524,"z":0},"angle":-0.9485057818699036,"power":1.2772500000000002,"pos":{"x":0.929399142038721,"y":0.5400176992463128,"z":0},"i":0},{"type":"AIM","offset":{"x":0.25675675675675674,"y":0.14864864864864866,"z":0},"angle":0.36219665509477494,"power":1.2772500000000002,"pos":{"x":0.8633734756813644,"y":-0.17580192863297145,"z":0},"i":0},{"type":"RERACK","ballinfo":{"balls":[{"pos":{"x":1.179,"y":0,"z":0},"id":6}]}},{"type":"AIM","offset":{"x":-0.013513513513513514,"y":0.14864864864864866,"z":0},"angle":-3.2117630457202053,"power":4.716,"pos":{"x":0.4613200930713131,"y":0.567484548361091,"z":0},"i":0},{"type":"AIM","offset":{"x":-0.013513513513513514,"y":0.14864864864864866,"z":0},"angle":-1.1776425236097912,"power":4.716,"pos":{"x":-0.10130915608117995,"y":0.3128675516011025,"z":0},"i":0},{"type":"RERACK","ballinfo":{"balls":[{"pos":{"x":0,"y":0,"z":0},"id":4}]}},{"type":"AIM","offset":{"x":-0.013513513513513514,"y":0.14864864864864866,"z":0},"angle":1.4404811140232954,"power":4.716,"pos":{"x":1.2801215735334959,"y":-0.6187661869804036,"z":0},"i":0},{"type":"AIM","offset":{"x":0.0045045045045045045,"y":0.06756756756756757,"z":0},"angle":-2.67560055976356,"power":4.716,"pos":{"x":0.5791958013523846,"y":0.2901110188756174,"z":0},"i":0},{"type":"RERACK","ballinfo":{"balls":[{"pos":{"x":0,"y":0,"z":0},"id":4}]}},{"type":"AIM","offset":{"x":-0.08558558558558559,"y":-0.06756756756756757,"z":0},"angle":-0.35042680406790483,"power":4.716,"pos":{"x":-0.7076748028830616,"y":-0.5270370963107135,"z":0},"i":0}],"start":1718613841142,"now":1718614055728,"score":39,"wholeGame":false}`
  const crushed = JSONCrush.crush(jsonstring)
  const uncrushed = JSONCrush.uncrush(crushed)
  const str = `('init!["O#P8646P2k5P8642O2k3P8649,0,-q147178X95878387P146988956X633uO7W9926X808k99PW056229580X7W623,q395893906X18687O0309834W456146122O7850v1321444826OW7943457746683393O8454_2104309055O03341822824u8297O8441550856490995P032X236957_79XO90u931V9k5247PW0X95v076Y56k3O8k8_10_246741P13V348623230549O0147452_1033V707P1443874k66455214O829968k8__169O1588_63v3212903O96158_Y6748612O054926Y98Wu618O9624122853032372P032284760V8649X5O9379_6790117894P09999597X507342,q107645661715287P44620987176293686,q03092u130422934P081Y68504579432,q39176k783899214O4556_91087890X,q1376920363088v4O5V9_88u113683,q1546284949v7069O6839774698702815]~shots![Z0N0Dj4396696969_9086$"NH#J!0*0N0D3.W415716V74614$H6321V2660731099Njk1k791214Y5VBS*0N0D3.167138993774994$H7723930460142693Nj1814736084u1383J!0*0N0D-2.688443315529157L4.91uWWWWW05FH179Y57774786289NH28432388628761u7BS* j299982Y845832245DH173603957109Y912L2.3088VFj3149266811670549NH315X10844_9W5J!0* H1W01734154167V7D-q13Yu687378848L4._38VFqX74810X7v8907NH5160592268528739BQ*UDH4171X21572609Y6TH7V95473V12_vNH118u0910501101J!0*UDj8218k8959429391T-q3338173Y5Y9613NH141042v566846626B%0N0Jd!4)])*H283974710158v5Nj09673863V264726D-q031V310v0Y803TH8020231743347841NH4430928130920293J!0*HW45045045045045045NH0k5k5k5k5k54Dq47611887Y484743Lq179Fq1_v960328XVNj3869310611859547BQ*j07471231X4318555Nj2905478797790549D-5.3W382623_4579Lq179Fq04X902vW64376NH1787851608026901J!0*j06V6V6V6V6V7Nju6V6V6V6V674D-q693163637X53331L2.1615FqX76_0921v9uNHk14410388Y1246BQ*j01v1v1v1v1v14Nj2Y7Y7Y7Y7Y77Dj71Y0924uu4_6Lq3V5WWWWW04FH660441524886108NH170720592u630506J!0)]~start!1718606k61k~now!171860Y8X93~score!37~wholeGame!false)*),ZBJ!0),('type!'RERACK'~ballinfo!('balls![('poD~z!0)~angle!F~po%H0.J~z!0)~iL~power!N~y!O,HP,jQ%q179N0Jd!6)])S%j8646Nj2k16666666666672Jd!1)])TLq6211uWWWW01FUH1636367Y88848386NHu14418597798Y44V75W00X19Y65Z('type!'AIM'~offset!('x!_27j-Hk40q1.u25v35 jW32u6X98342282_N"j245482363X30444#208704710v58783$L3.438VF%s!('x!â%$#" vuqkj_ZYXWVUTSQPONLJHFDB*_`

  const data = JSONCrush.uncrush(str)

  it("jsonCrush", (done) => {
    console.log(crushed)
    console.log(uncrushed)
    expect(str).to.be.length(1973)
    expect(uncrushed).to.be.eq(jsonstring)
    done()
  })
})
