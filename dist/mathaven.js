"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[893],{"./src/events/eventtype.ts"(e,t,n){n.d(t,{B:()=>r});var i,r=((i={}).BEGIN="BEGIN",i.BREAK="BREAK",i.WATCHAIM="WATCHAIM",i.AIM="AIM",i.HIT="HIT",i.STATIONARY="STATIONARY",i.CHAT="CHAT",i.ABORT="ABORT",i.PLACEBALL="PLACEBALL",i.REJOIN="REJOIN",i.RERACK="RERACK",i.STARTAIM="STARTAIM",i.NOTIFICATION="NOTIFICATION",i.SCORE="SCORE",i)},"./src/mathaven.ts"(e,t,n){var i=n("./src/model/physics/mathaven.ts");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){return(o="u">typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n||e):r.value}})(e,t,n||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}var c=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(){var e,t,i;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return t=n,i=arguments,t=a(t),r(e=function(e,t){var n;if(t&&("object"==((n=t)&&"u">typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,s()?Reflect.construct(t,i||[],a(this).constructor):t.apply(this,i)),"h",[]),r(e,"extractValues",function(t){return e.h.map(t).map(function(e){return null!=e?e:0})}),e}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&l(n,e),t=[{key:"updateSingleStep",value:function(e){o(a(n.prototype),"updateSingleStep",this).call(this,e),this.h.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){r(e,t,n[t])})}return e}({},this))}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(n.prototype,t),n}(i.z),u={responsive:!0,showLink:!0,plotlyServerURL:"https://chart-studio.plotly.com"},h={legend:{font:{color:"#4D5663"},bgcolor:"#e5e6F9"},title:{text:"",font:{size:11}},xaxis:{title:"impulse",tickfont:{color:"#4D5663"},gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},yaxis:{title:"value",tickfont:{color:"#4D5663"},zeroline:!1,gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},plot_bgcolor:"#F5F6F9",paper_bgcolor:"#F2F6F9"};function v(e){return"hsl(".concat(137.5*e%360,", ").concat(70,"%, ").concat(50,"%)")}function f(e,t,n,i){return{x:e,y:t,name:n,line:{color:i,width:1.3},mode:"lines",type:"scatter"}}var d=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"plot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*e/.02625,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5*e/.02625,r=new c(.1406,.02625,.98,.212,.14);try{r.solvePaper(e,t,n,i)}catch(e){console.error(e)}var o=r.extractValues,a=o(function(e){return e.P});h.title.text=`<b>Figure.12</b> Slip–impulse curves 
for V0 = 2 m/s, α = 45◦,ωS0 = 2V0/R, and ωT0 = 1.5V0/R 
<br>(s and φ are for the slip at the cushion, 
and sʹ and φʹ are for the slip at the table)`,window.Plotly.newPlot("mathaven-impulse",[f(a,o(function(e){return e.s}),"s",v(0)),f(a,o(function(e){return e.φ}),"φ",v(1)),f(a,o(function(e){return e.sʹ}),"s'",v(2)),f(a,o(function(e){return e.φʹ}),"φʹ",v(3)),f(a,o(function(e){return e.WzI}),"WzI",v(4)),f(a,o(function(e){return e.P}),"P",v(5))],h,u)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}(),p=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"getFinalState",value:function(e,t,n,r){try{var o=new i.z(.1406,.02625,.98,.212,.14);o.solvePaper(e,t,n,r);var a=o.vy,l=o.vx;return{beta:180/Math.PI*Math.atan2(-a,l),speed:Math.sqrt(l*l+a*a)}}catch(e){return console.error(e),{beta:NaN,speed:NaN}}}},{key:"plot",value:function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return 0},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(e){return e/.02625},o=[],a=[],l=[],s=-1;s<=2;s++){var c=[],d=[];l=[];for(var p=1;p<90;p+=9){l.push(p);var y=this.getFinalState(1,Math.PI/180*p,i(s),r(s));c.push(y.speed),d.push(y.beta)}o.push(c),a.push(d)}var m=l;h.title.text=n,window.Plotly.newPlot(e,[f(m,o[0],"k=-1",v(0)),f(m,o[1],"k=0",v(1)),f(m,o[2],"k=1",v(2)),f(m,o[3],"k=2",v(3))],h,u),window.Plotly.newPlot(t,[f(m,a[0],"k=-1",v(0)),f(m,a[1],"k=0",v(1)),f(m,a[2],"k=1",v(2)),f(m,a[3],"k=2",v(3))],h,u)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}(),y=n("./node_modules/three/build/three.core.js"),m=n("./src/model/ball.ts"),g=n("./src/utils/utils.ts"),b=n("./src/model/physics/collision.ts");function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(){var e;function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!(this instanceof t))throw TypeError("Cannot call a class as a function");w(this,"log",void 0),this.log=e}return e=[{key:"dynamicFriction",value:function(e){return t.a+t.b*Math.exp(-t.c*e)}},{key:"relativeVelocity",value:function(e,n,i,r){return Math.sqrt(Math.pow(e*Math.sin(r)-i*t.R,2)+Math.pow(Math.cos(r)*n*t.R,2))}},{key:"throwAngle",value:function(e,n,i,r){var o=this.relativeVelocity(e,n,i,r),a=this.dynamicFriction(o),l=Math.min(a*e*Math.cos(r)/o,1/7)*(e*Math.sin(r)-t.R*i),s=e*Math.cos(r);return this.log("inputs:v=".concat(e,", ωx=").concat(n,", ωz=").concat(i,", ϕ=").concat(r)),this.log("   v * Math.sin(ϕ) =".concat(e*Math.sin(r))),this.log("   CollisionThrow.R * ωz =".concat(t.R*i)),this.log("   Math.min((μ * v * Math.cos(ϕ)) / vRel, 1 / 7) =".concat(Math.min(a*e*Math.cos(r)/o,1/7))),this.log("   (v * Math.sin(ϕ) - CollisionThrow.R * ωz) =".concat(e*Math.sin(r)-t.R*i)),this.log(""),this.log("vRel = ",o),this.log("μ = ",a),this.log("numerator = ",l),this.log("denominator = ",s),this.log("throw = ",Math.atan2(l,s)),Math.atan2(l,s)}},{key:"plot",value:function(e,n,i,r){var o=new m.c(g.v_);o.vel.copy(new y.Pq0(0,e,0)),o.rvel.copy(new y.Pq0(n,0,i));var a=new y.Pq0(0,2*t.R).applyAxisAngle(g.up,r),l=new m.c(a);return b.F.model.updateVelocities(o,l),Math.atan2(b.F.model.tangentialImpulse,-b.F.model.normalImpulse)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}();w(P,"R",.029),w(P,"a",.01),w(P,"b",.108),w(P,"c",1.088);function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){var i;i=n[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i})}return e}var x=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"degToRad",value:function(e){return Math.PI/180*e}},{key:"radToDeg",value:function(e){return 180/Math.PI*e}},{key:"plotCutAngle",value:function(){var e=P.R;this.plot("collision-throw-roll",[.447,1.341,3.129],function(t){return t/e}),this.plot("collision-throw-stun",[.447,1.341,3.129],function(e){return 0}),this.plotRolls("collision-throw-varying-roll",[0,.25,.5,1],function(t){return t/e},function(e){return 0},function(e){return e}),this.plotRolls("collision-throw-varying-side",[0,.25,.5,1],function(t){return t/e},function(t){return 1/e*(t-45)/45},function(e){return 0}),new P(console.log).plot(.5,-15,-10,Math.PI/8)}},{key:"plot",value:function(e,t,n){var i=this,r=[],o=[];t.forEach(function(e){var t=[];o=[];for(var a=1;a<90;a+=1){o.push(a);var l=new P().plot(e,n(e),0,i.degToRad(a));t.push(i.radToDeg(l))}r.push(t)});var a=M({},h);a.title.text=`Throw effect (WIP)
    <br>throw vs. cut angle for various-speed `.concat(e,` shots
    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf`),window.Plotly.newPlot(e,[f(o,r[0],"slow",v(4)),f(o,r[1],"medium",v(5)),f(o,r[2],"fast",v(6))],a,u)}},{key:"plotRolls",value:function(e,t,n,i,r){var o=this,a=[],l=[];t.forEach(function(e){var t=[];l=[];for(var s=1;s<90;s+=1){l.push(s);var c=new P().plot(1,n(e),i(s),o.degToRad(r(s)));t.push(o.radToDeg(c))}a.push(t)});var s=M({},h);s.title.text=`Throw effect (WIP)
    <br>throw vs. cut angle for various-speed `.concat(e,` shots
    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf`),window.Plotly.newPlot(e,[f(l,a[0],"0",v(4)),f(l,a[1],"0.25",v(5)),f(l,a[2],"0.5",v(6)),f(l,a[3],"1.0",v(7))],s,u)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}();new d().plot();var k=`<b>Figure.9</b> Rebound speed and rebound angle versus incident angle <br>
    for different topspins of the ball, ωT0 = kV0/R and V0 = 1 m/s with no sidespin`;new p().plot("mathaven-figure9-speed","mathaven-figure9-angle",k);var R=`<b>Figure.10</b> Rebound speed and rebound angle versus incident angle <br>
for different sidespins of the ball,ωS0 = kV0/R and V0 = 1 m/s with the ball rolling (ωT0 = V0/R)`;new p().plot("mathaven-figure10-speed","mathaven-figure10-angle",R,function(e){return e/.02625},function(e){return 38.095238095238095}),new x().plotCutAngle()},"./src/model/ball.ts"(e,t,n){n.d(t,{c:()=>M,U:()=>P});var i,r,o,a,l,s=n("./src/utils/utils.ts"),c=n("./src/model/physics/physics.ts"),u=n("./node_modules/three/build/three.core.js"),h=n("./src/model/physics/constants.ts");function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){var e;function t(e,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");v(this,"line",void 0),v(this,"geometry",void 0),v(this,"positions",void 0),v(this,"lastPos",new u.Pq0),v(this,"lastVel",new u.Pq0),this.geometry=new u.LoY,this.positions=new Float32Array(3*e),this.geometry.setAttribute("position",new u.THS(this.positions,3)),this.reset();var i=new u.mrM({color:n,opacity:.25,linewidth:3,transparent:!0});this.line=new u.N1A(this.geometry,i),this.line.visible=!1}return e=[{key:"reset",value:function(){this.geometry.setDrawRange(0,0),this.lastVel.setZ(1)}},{key:"forceTrace",value:function(e){this.lastVel.z=1,this.addTraceGiven(e,this.lastVel,1,.1,1)}},{key:"addTrace",value:function(e,t){if(0!==t.length()){var n=this.lastVel.angleTo(t),i=n>Math.PI/32?.01*h.R:h.R,r=this.lastPos.distanceTo(e);this.addTraceGiven(e,t,r,i,n)}}},{key:"addTraceGiven",value:function(e,t,n,i,r){var o=this.geometry.drawRange.count;0!==o&&n<i||(o>1&&r<1e-4&&o--,this.lastPos.copy(e),this.lastVel.copy(t),this.addPoint(e,o))}},{key:"addPoint",value:function(e,t){var n=3*t;n>this.positions.length||(this.positions[n++]=e.x,this.positions[n++]=e.y,this.positions[n]=e.z,this.geometry.setDrawRange(0,t+1),this.line.geometry.attributes.position.needsUpdate=!0)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}(),d=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"getOrCreateTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256,i="".concat(e,"_").concat(t.getHex(),"_").concat(n);if(this.textureCache.has(i))return this.textureCache.get(i);var r=this.createNumberTexture(e,t,n);return this.textureCache.set(i,r),r}},{key:"createNumberTexture",value:function(e,t,n){var i=n/256,r=document.createElement("canvas");r.width=n,r.height=n;var o=r.getContext("2d");if(!o)return new u.GOR(r);if(o.fillStyle="#".concat(t.getHexString()),o.fillRect(0,0,r.width,r.height),e>=9&&(o.fillStyle="white",o.fillRect(0,0,n,.2*n),o.fillRect(0,.8*n,n,.2*n)),e>0){var a=n/2,l=n/2,s=Math.round(52*i),c=Math.round(15*i);o.beginPath(),o.arc(a,l,s+c,0,2*Math.PI),o.fillStyle="black",o.fill(),o.beginPath(),o.arc(a,l,s,0,2*Math.PI),o.fillStyle="white",o.fill(),o.fillStyle="black",o.strokeStyle="black";var h=Math.round(97*i);o.lineWidth=.05*h,o.font="900 ".concat(h,'px "Arial Black", Arial, sans-serif'),o.textAlign="center",o.textBaseline="middle";var v=l+Math.round(5*i);o.strokeText(e.toString(),a,v),o.fillText(e.toString(),a,v)}var f=new u.GOR(r);return f.flipY=!1,f}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();i="textureCache",r=new Map,i in d?Object.defineProperty(d,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):d[i]=r;var p=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"createDottedMaterial",value:function(e){var t="dotted_".concat(e.getHex());if(this.materialCache.has(t))return this.materialCache.get(t);var n=new u.tXL({emissive:0,flatShading:!0,vertexColors:!0,forceSinglePass:!0,shininess:25,specular:5592371});return this.materialCache.set(t,n),n}},{key:"createProjectedMaterial",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256,i="projected_".concat(e,"_").concat(t.getHex(),"_").concat(n);if(this.materialCache.has(i))return this.materialCache.get(i);var r=d.getOrCreateTexture(e,t,n),o=new u._4j({color:t,roughness:.5,metalness:0,flatShading:!0});return o.onBeforeCompile=function(e){e.uniforms.numberTex={value:r},e.uniforms.projSize={value:2},e.vertexShader=e.vertexShader.replace("#include <common>",`#include <common>
         varying vec3 vLocalPosition;
         varying vec3 vNormalVar;`),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>
         vLocalPosition = position;
         vNormalVar = normal;`),e.fragmentShader=e.fragmentShader.replace("#include <common>",`#include <common>
        uniform sampler2D numberTex;
        uniform float projSize;
        varying vec3 vLocalPosition;
        varying vec3 vNormalVar;`),e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`#include <color_fragment>
         float r = `.concat(h.R.toFixed(3),`;
         vec3 locPos = vLocalPosition;

         // planar projection
         vec2 projUv = locPos.xz / (r * projSize) + 0.5;
         projUv = clamp(projUv, 0.0, 1.0);

         // sample & blend
         vec4 texColor = texture2D(numberTex, projUv);
         diffuseColor.rgb = texColor.rgb;
        `))},this.materialCache.set(i,o),o}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}o="materialCache",a=new Map,o in p?Object.defineProperty(p,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):p[o]=a;var g=function(){var e,t;function n(e,t){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");m(this,"mesh",void 0),m(this,"shadow",void 0),m(this,"spinAxisArrow",void 0),m(this,"trace",void 0),m(this,"color",void 0),m(this,"m",new u.kn4),this.color=new u.Q1f(e),this.initialiseMesh(this.color,t)}return e=[{key:"updateAll",value:function(e,t){this.updatePosition(e.pos),this.updateArrows(e.pos,e.rvel,e.state),0!==e.rvel.lengthSq()&&(this.updateRotation(e.rvel,t),this.trace.addTrace(e.pos,e.vel))}},{key:"updatePosition",value:function(e){this.mesh.position.copy(e),this.shadow.position.copy(e)}},{key:"updateRotation",value:function(e,t){var n=e.length()*t;this.mesh.rotateOnWorldAxis((0,s.xb)(e),n)}},{key:"updateArrows",value:function(e,t,n){this.spinAxisArrow.setLength(h.R+h.R*t.length()/2,h.R,h.R),this.spinAxisArrow.position.copy(e),this.spinAxisArrow.setDirection((0,s.xb)(t)),n==P.Rolling?this.spinAxisArrow.setColor(0xcc0000):this.spinAxisArrow.setColor(52224)}},{key:"initialiseMesh",value:function(e,t){if(void 0===t){var i,r,o=e.getHex(),a=n._dottedGeometryCache.get(o);a||(a=new u.WBB(h.R,1),n.addDots(a,e),n._dottedGeometryCache.set(o,a)),i=a,r=p.createDottedMaterial(e)}else i=n.getBallGeometry(),r=p.createProjectedMaterial(t,e);this.mesh=new u.eaF(i,r),this.mesh.name="ball",this.updateRotation(new u.Pq0().random(),100),this.shadow=new u.eaF(n.getShadowGeometry(),n.getShadowMaterial()),this.spinAxisArrow=new u.E0M(s.up,s.v_,2,0,.01,.01),this.spinAxisArrow.visible=!1,this.trace=new f(500,e)}},{key:"addToScene",value:function(e){e.add(this.mesh),e.add(this.shadow),e.add(this.spinAxisArrow),e.add(this.trace.line)}}],t=[{key:"getBallGeometry",value:function(){return this._ballGeometry||(this._ballGeometry=new u.WBB(h.R,1)),this._ballGeometry}},{key:"getShadowGeometry",value:function(){return this._shadowGeometry||(this._shadowGeometry=new u.tcD(.9*h.R,9),this._shadowGeometry.applyMatrix4(new u.kn4().makeTranslation(0,0,-(.99*h.R)))),this._shadowGeometry}},{key:"getShadowMaterial",value:function(){return this._shadowMaterial||(this._shadowMaterial=new u.V9B({color:1118498})),this._shadowMaterial}},{key:"addDots",value:function(e,t){var i=e.attributes.position.count,r=new u.Q1f(t);e.setAttribute("color",new u.THS(new Float32Array(3*i),3));for(var o=e.attributes.color,a=0;a<i/3;a++)n.colorVerticesForFace(a,o,n.scaleNoise(r.r),n.scaleNoise(r.g),n.scaleNoise(r.b));var l=new u.Q1f(0xaa2222);[0,96,111,156,186,195].forEach(function(e){n.colorVerticesForFace(e/3,o,l.r,l.g,l.b)})}},{key:"colorVerticesForFace",value:function(e,t,n,i,r){t.setXYZ(3*e+0,n,i,r),t.setXYZ(3*e+1,n,i,r),t.setXYZ(3*e+2,n,i,r)}},{key:"scaleNoise",value:function(e){return(1-.25*Math.random())*e}}],e&&y(n.prototype,e),t&&y(n,t),n}();function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}m(g,"_ballGeometry",void 0),m(g,"_shadowGeometry",void 0),m(g,"_shadowMaterial",void 0),m(g,"_dottedGeometryCache",new Map);var P=((l={}).Stationary="Stationary",l.Rolling="Rolling",l.Sliding="Sliding",l.Falling="Falling",l.InPocket="InPocket",l),M=function(){var e,t;function n(e,t,i){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");w(this,"pos",void 0),w(this,"vel",s.v_.clone()),w(this,"rvel",s.v_.clone()),w(this,"futurePos",s.v_.clone()),w(this,"ballmesh",void 0),w(this,"state","Stationary"),w(this,"pocket",void 0),w(this,"id",n.id++),w(this,"label",void 0),this.pos=e.clone(),this.label=i,this.ballmesh=new g(t||0xeeeeee*Math.random(),i)}return e=[{key:"update",value:function(e){this.updatePosition(e),"Falling"==this.state?this.pocket.updateFall(this,e):this.updateVelocity(e)}},{key:"updateMesh",value:function(e){this.ballmesh.updateAll(this,e)}},{key:"updatePosition",value:function(e){this.pos.addScaledVector(this.vel,e)}},{key:"updateVelocity",value:function(e){this.inMotion()&&(this.isRolling()?(this.state="Rolling",(0,c.lx)(this.vel,this.rvel),this.addDelta(e,(0,c.JD)(this.rvel))):(this.state="Sliding",this.addDelta(e,(0,c.p2)(this.vel,this.rvel))))}},{key:"addDelta",value:function(e,t){t.v.multiplyScalar(e),t.w.multiplyScalar(e),this.passesZero(t)||(this.vel.add(t.v),this.rvel.add(t.w))}},{key:"passesZero",value:function(e){var t=(0,s.rq)(this.vel,e.v),n=(0,s.rq)(this.rvel,e.w);return!!(("Rolling"===this.state?t||n:t&&n)&&.01>Math.abs(this.rvel.z))&&(this.setStationary(),!0)}},{key:"setStationary",value:function(){this.vel.copy(s.v_),this.rvel.copy(s.v_),this.state="Stationary"}},{key:"isRolling",value:function(){return 0!==this.vel.lengthSq()&&0!==this.rvel.lengthSq()&&(0,c.Mq)(this.vel,this.rvel).length()<n.transition}},{key:"onTable",value:function(){return"Falling"!==this.state&&"InPocket"!==this.state}},{key:"inMotion",value:function(){return"Rolling"===this.state||"Sliding"===this.state||this.isFalling()}},{key:"isFalling",value:function(){return"Falling"===this.state}},{key:"futurePosition",value:function(e){return this.futurePos.copy(this.pos).addScaledVector(this.vel,e),this.futurePos}},{key:"fround",value:function(){this.pos.x=Math.fround(this.pos.x),this.pos.y=Math.fround(this.pos.y),this.vel.x=Math.fround(this.vel.x),this.vel.y=Math.fround(this.vel.y),this.rvel.x=Math.fround(this.rvel.x),this.rvel.y=Math.fround(this.rvel.y),this.rvel.z=Math.fround(this.rvel.z)}},{key:"serialise",value:function(){return{pos:this.pos.clone(),id:this.id}}}],t=[{key:"fromSerialised",value:function(e){return n.updateFromSerialised(new n((0,s.t6)(e.pos)),e)}},{key:"updateFromSerialised",value:function(e,t){var n,i;return e.pos.copy(t.pos),e.vel.copy(null!=(n=null==t?void 0:t.vel)?n:s.v_),e.rvel.copy(null!=(i=null==t?void 0:t.rvel)?i:s.v_),e}}],e&&b(n.prototype,e),t&&b(n,t),n}();w(M,"id",0),w(M,"transition",.05)},"./src/model/physics/collision.ts"(e,t,n){n.d(t,{F:()=>h});var i,r,o=n("./src/model/ball.ts"),a=n("./node_modules/three/build/three.core.js"),l=n("./src/model/physics/constants.ts"),s=n("./src/utils/utils.ts");function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");c(this,"normalImpulse",void 0),c(this,"tangentialImpulse",void 0)}return e=[{key:"dynamicFriction",value:function(e){return .01+.108*(0,s.oN)(-1.088*e)}},{key:"updateVelocities",value:function(e,t){var n=h.positionsAtContact(e,t);e.ballmesh.trace.forceTrace(n.a),t.ballmesh.trace.forceTrace(n.b);var i=n.b.sub(n.a).normalize(),r=new a.Pq0(-i.y,i.x,0),o=e.vel.clone().sub(t.vel).add(i.clone().multiplyScalar(-l.R).cross(e.rvel).sub(i.clone().multiplyScalar(l.R).cross(t.rvel))),s=i.dot(o),c=o.addScaledVector(i,-s),u=c.length(),v=r.dot(c),f=this.dynamicFriction(u);this.normalImpulse=-1.99*s/(2/l.m),this.tangentialImpulse=-(.25*Math.min(f*Math.abs(this.normalImpulse)/u,1/7)*v);var d=i.clone().multiplyScalar(this.normalImpulse),p=r.clone().multiplyScalar(this.tangentialImpulse);e.vel.addScaledVector(d,1/l.m).addScaledVector(p,1/l.m),t.vel.addScaledVector(d,-1/l.m).addScaledVector(p,-1/l.m);var y=i.clone().multiplyScalar(-l.R).cross(p),m=i.clone().multiplyScalar(l.R).cross(p);return e.rvel.addScaledVector(y,1/l.I),t.rvel.addScaledVector(m,1/l.I),s}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}(),h=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"willCollide",value:function(e,t,n){return(e.inMotion()||t.inMotion())&&e.onTable()&&t.onTable()&&e.futurePosition(n).distanceToSquared(t.futurePosition(n))<4*l.R*l.R}},{key:"collide",value:function(e,n){return t.updateVelocities(e,n)}},{key:"positionsAtContact",value:function(e,t){var n=e.pos.distanceTo(t.pos),i=e.vel.clone().sub(t.vel),r=(n-2*l.R)/i.length()||0;return{a:e.pos.clone().addScaledVector(e.vel,r),b:t.pos.clone().addScaledVector(t.vel,r)}}},{key:"updateVelocities",value:function(e,n){var i=t.model.updateVelocities(e,n);return e.state=o.U.Sliding,n.state=o.U.Sliding,i}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();i="model",r=new u,i in h?Object.defineProperty(h,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):h[i]=r},"./src/model/physics/constants.ts"(e,t,n){n.d(t,{I:()=>o,Mz:()=>i,PX:()=>O,Qg:()=>P,R:()=>v,Wv:()=>x,Ys:()=>k,Z3:()=>m,_m:()=>y,cM:()=>R,e:()=>f,ee:()=>d,g:()=>a,gT:()=>c,gf:()=>s,jG:()=>w,kL:()=>u,kM:()=>S,ki:()=>T,ko:()=>A,m:()=>h,mu:()=>l,o5:()=>g,oV:()=>p,x3:()=>r,xO:()=>M});var i,r,o,a=9.8,l=.00985,s=.16,c=.85,u=.034,h=.23,v=.03275,f=.86,d=.98,p=.212,y=.14,m=.4,g=Math.sqrt(21)/5;function b(){i=l*h*a*2/3*u,r=7/(5*Math.sqrt(2))*v*l*h*a,o=.4*h*v*v}function w(e){v=e,b()}function P(e){h=e,b()}function M(e){l=e,b()}function x(e){u=e,b()}function k(e){s=e}function R(e){f=e}function S(e){c=e}function A(e){p=e}function T(e){y=e}function O(e){d=e}b()},"./src/model/physics/mathaven.ts"(e,t,n){n.d(t,{z:()=>a});var i=n("./src/utils/utils.ts"),r=n("./src/model/physics/constants.ts");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){var e;function t(e,n,i,r,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"P",0),o(this,"WzI",0),o(this,"vx",void 0),o(this,"vy",void 0),o(this,"ωx",void 0),o(this,"ωy",void 0),o(this,"ωz",void 0),o(this,"s",void 0),o(this,"φ",void 0),o(this,"sʹ",void 0),o(this,"φʹ",void 0),o(this,"i",0),o(this,"N",100),o(this,"M",void 0),o(this,"R",void 0),o(this,"μs",void 0),o(this,"μw",void 0),o(this,"ee",void 0),this.M=e,this.R=n,this.ee=i,this.μs=r,this.μw=a}return e=[{key:"updateSlipSpeedsAndAngles",value:function(){var e=this.R,t=this.vx+this.ωy*e*r.Z3-this.ωz*e*r.o5,n=-this.vy*r.Z3+this.ωx*e,o=this.vx-this.ωy*e,a=this.vy+this.ωx*e;this.s=(0,i.RZ)((0,i.n7)(t,2)+(0,i.n7)(n,2)),this.φ=(0,i.FP)(n,t),this.φ<0&&(this.φ+=2*Math.PI),this.sʹ=(0,i.RZ)((0,i.n7)(o,2)+(0,i.n7)(a,2)),this.φʹ=(0,i.FP)(a,o),this.φʹ<0&&(this.φʹ+=2*Math.PI)}},{key:"compressionPhase",value:function(){for(var e=Math.max(this.M*this.vy/this.N,.001);this.vy>0;)this.updateSingleStep(e)}},{key:"restitutionPhase",value:function(e){var t=Math.max(e/this.N,.001);for(this.WzI=0;this.WzI<e;)this.updateSingleStep(t)}},{key:"updateSingleStep",value:function(e){if(this.updateSlipSpeedsAndAngles(),this.updateVelocity(e),this.updateAngularVelocity(e),this.updateWorkDone(e),this.i++>10*this.N)throw Error("Solution not found")}},{key:"updateVelocity",value:function(e){var t=this.μs,n=this.μw,o=this.M;this.vx-=1/o*(n*(0,i.gn)(this.φ)+t*(0,i.gn)(this.φʹ)*(r.Z3+n*(0,i.F8)(this.φ)*r.o5))*e,this.vy-=1/o*(r.o5-n*r.Z3*(0,i.F8)(this.φ)+t*(0,i.F8)(this.φʹ)*(r.Z3+n*(0,i.F8)(this.φ)*r.o5))*e}},{key:"updateAngularVelocity",value:function(e){var t=this.μs,n=this.μw,o=this.M,a=this.R;this.ωx+=-(5/(2*o*a))*(n*(0,i.F8)(this.φ)+t*(0,i.F8)(this.φʹ)*(r.Z3+n*(0,i.F8)(this.φ)*r.o5))*e,this.ωy+=-(5/(2*o*a))*(n*(0,i.gn)(this.φ)*r.Z3-t*(0,i.gn)(this.φʹ)*(r.Z3+n*(0,i.F8)(this.φ)*r.o5))*e,this.ωz+=5/(2*o*a)*(n*(0,i.gn)(this.φ)*r.o5)*e}},{key:"updateWorkDone",value:function(e){var t=e*Math.abs(this.vy);this.WzI+=t,this.P+=e}},{key:"solvePaper",value:function(e,t,n,r){this.solve(e*(0,i.gn)(t),e*(0,i.F8)(t),-r*(0,i.F8)(t),r*(0,i.gn)(t),n)}},{key:"solve",value:function(e,t,n,i,r){this.vx=e,this.vy=t,this.ωx=n,this.ωy=i,this.ωz=r,this.WzI=0,this.P=0,this.i=0,this.compressionPhase();var o=this.ee*this.ee*this.WzI;this.restitutionPhase(o)}}],function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}()},"./src/model/physics/physics.ts"(e,t,n){n.d(t,{$8:()=>S,Gp:()=>w,JD:()=>h,Mq:()=>s,QK:()=>f,QV:()=>R,Qy:()=>O,Un:()=>b,c0:()=>g,lx:()=>v,p2:()=>u,s0:()=>m,t6:()=>I,yO:()=>P});var i=n("./node_modules/three/build/three.core.js"),r=n("./src/utils/utils.ts"),o=n("./src/model/physics/constants.ts"),a=n("./src/model/physics/mathaven.ts"),l=new i.Pq0;function s(e,t){return l.copy(e).addScaledVector((0,r.KM)(t),o.R)}var c={v:new i.Pq0,w:new i.Pq0};function u(e,t){var n=s(e,t).setZ(0);return c.v.copy((0,r.xb)(n).multiplyScalar(-o.gf*o.g)),c.w.copy((0,r.xb)((0,r.KM)(n)).multiplyScalar(2.5*o.gf*o.g/o.R)),c.w.setZ(-2.5*(o.Mz/(o.m*o.R*o.R))*Math.sign(t.z)),c}function h(e){var t=new i.Pq0(e.x,e.y,0).length(),n=5/7*o.x3/(o.m*o.R)/t,r=5/7*o.x3/(o.m*o.R*o.R)/t;return c.v.set(-n*e.y,n*e.x,0),c.w.set(-r*e.x,-r*e.y,-2.5*(o.Mz/(o.m*o.R*o.R))*Math.sign(e.z)),c}function v(e,t){var n=t.z;t.copy((0,r.KM)(e).multiplyScalar(1/o.R)),t.setZ(n)}function f(e,t,n,i){var o=i(t.clone().applyAxisAngle(r.up,e),n.clone().applyAxisAngle(r.up,e));return o.v.applyAxisAngle(r.up,-e),o.w.applyAxisAngle(r.up,-e),o}Object.freeze(c);var d=Math.asin(.1*o.R/o.R),p=(0,r.F8)(d),y=(0,r.gn)(d);function m(e,t){return new i.Pq0(e.x*p-e.z*y+o.R*t.y,-e.y-o.R*t.z*y+o.R*t.x*p)}function g(e){return e.x*y}function b(e){var t=3.5/o.m;return e.length()/t}function w(e){var t,n=1/o.m,r=.39+.257*(t=new i.Pq0(e/y,0,0)).x-.044*t.x*t.x;return o.gT*((1+r)*e)/n}function P(e,t){var n=w(g(e));return b(m(e,t))<=n}function M(e,t){return{c:g(e),s:m(e,t),A:3.5/o.m,B:1/o.m}}function x(e,t){var n=M(e,t),i=n.c,r=n.s,a=n.A,l=n.B,s=(1+o.e)*(i/l);return A(-r.x/a*p-s*y,r.y/a,r.x/a*y-s*p)}function k(e,t){var n,i=M(e,t),r=i.c,a=i.B,l=(1+o.e)*(r/a),s=.471-.241*Math.atan2(Math.abs((n=e).y),n.x),c=Math.atan2(e.y,e.x),u=Math.cos(c);return A(-s*l*u*y-l*y,s*l*Math.sin(c),s*l*u*y-l*p)}function R(e,t){return P(e,t)?x(e,t):k(e,t)}function S(e,t){var n=x(e,t),i=k(e,t),r=Math.sign(e.y)===Math.sign(t.z)?Math.cos(Math.atan2(e.y,e.x)):1;return{v:i.v.lerp(n.v,r),w:i.w.lerp(n.w,r)}}function A(e,t,n){return{v:new i.Pq0(e/o.m,t/o.m),w:new i.Pq0(-o.R/o.I*t*p,o.R/o.I*(e*p-n*y),o.R/o.I*t*y)}}function T(e,t){var n=new a.z(o.m,o.R,o.ee,o.oV,o._m+.1);n.solve(e.x,e.y,t.x,t.y,t.z);var r=new i.Pq0(n.vx,n.vy,0),l=new i.Pq0(n.ωx,n.ωy,n.ωz);return{v:r.sub(e),w:l.sub(t)}}function O(e,t){return f(Math.PI/2,e,t,T)}function I(e,t){var n=Math.atan2(-e.x,e.y),i=2.5*t.length()*(e.length()*o.R)/(o.R*o.R),a=t.clone().normalize();return(0,r.KM)(a).applyAxisAngle(a,n).multiplyScalar(i)}},"./src/utils/utils.ts"(e,t,n){n.d(t,{Dz:()=>p,F8:()=>w,FP:()=>g,KM:()=>u,RZ:()=>M,gn:()=>P,hs:()=>l,ld:()=>m,n7:()=>b,oN:()=>x,rq:()=>d,t6:()=>s,up:()=>a,v_:()=>o,xb:()=>v});var i=n("./node_modules/three/build/three.core.js"),r=n("./src/events/eventtype.ts"),o=new i.Pq0(0,0,0),a=new i.Pq0(0,0,1);function l(e){return!e.entries.some(function(e){return e.event.type===r.B.HIT})}function s(e){return new i.Pq0(e.x,e.y,e.z)}var c=new i.Pq0;function u(e){return c.copy(a).cross(e)}var h=new i.Pq0;function v(e){return h.copy(e).normalize()}var f=new i.Pq0;function d(e,t){return 0>=f.copy(e).add(t).dot(e)}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.Pq0;return t.set(1,0,0).applyAxisAngle(a,e)}function y(e){return Math.sign(e)*Math.floor((Math.abs(e)+Number.EPSILON)*1e4)/1e4}function m(e){return e.x=y(e.x),e.y=y(e.y),e.z=y(e.z),e}function g(e,t){return Math.fround(Math.atan2(e,t))}function b(e,t){return Math.fround(Math.pow(e,t))}function w(e){return Math.fround(Math.sin(e))}function P(e){return Math.fround(Math.cos(e))}function M(e){return Math.fround(Math.sqrt(e))}function x(e){return Math.fround(Math.exp(e))}}},e=>{e(e.s="./src/mathaven.ts")}]);